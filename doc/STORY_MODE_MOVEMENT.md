# Story Mode Linear Movement Feature

## Overview
实现了剧情模式的线性移动功能，区别于探索模式的自由移动，剧情模式采用点击按钮向下一个检查点前进的方式。

## 功能特性

### 1. 双模式移动系统
- **探索模式（Exploration Mode）**：保持原有的摇杆拖拽移动
- **剧情模式（Story Mode）**：新增线性移动按钮

### 2. 剧情模式移动逻辑
- 点击移动按钮，自动朝下一个检查点前进
- 每次移动固定距离（50米）或剩余距离（如果小于50米）
- 自动计算方向和距离
- 消耗相应的步数

### 3. 实时反馈
- **距离提示**：显示到下一个检查点的距离和所需步数
- **移动反馈**：显示剩余距离和步数
- **到达提示**：到达检查点时显示成功消息

### 4. UI/UX 优化

#### 移动按钮设计
- 圆形渐变按钮（蓝色到靛蓝色）
- 脉冲动画效果
- Hover 时缩放和阴影效果
- 点击时平滑的缩放反馈
- 箭头图标向右移动的微交互

#### 信息展示
- 顶部显示目标检查点信息卡片
  - 检查点名称
  - 距离（米）
  - 所需步数
  - 导航图标
- 渐变背景（蓝色到靛蓝色）
- 圆角卡片设计

## 技术实现

### 新增工具函数（`utils/geo.ts`）

```typescript
// 计算两点之间的距离（米）
calculateDistance(from: LatLng, to: LatLng): number

// 计算从一点到另一点的方位角（度）
calculateBearing(from: LatLng, to: LatLng): number
```

### 核心函数

#### `getNextStoryCheckpoint()`
- 获取下一个未完成的剧情检查点
- 按 `order` 字段排序
- 过滤已完成的检查点

#### `handleStoryModeMove()`
- 计算到目标的距离和方向
- 每次移动50米（或剩余距离）
- 检查步数是否足够
- 更新用户位置
- 提供实时反馈

### 状态管理
- 使用现有的 `gameMode` 状态区分模式
- 使用 `getNextStoryCheckpoint()` 获取目标
- 复用 `executeMove()` 执行移动

## 用户体验

### 探索模式
- 自由拖拽移动
- 显示计划移动距离
- 保持原有交互方式

### 剧情模式
- 线性进度
- 明确的目标指引
- 简单的点击交互
- 实时距离反馈
- 自动导航

## 视觉设计

### 按钮样式
- **尺寸**：80x80px
- **颜色**：蓝色渐变（#3B82F6 → #4F46E5）
- **阴影**：2xl + hover 时蓝色光晕
- **动画**：
  - 脉冲效果（ping animation）
  - Hover 缩放（105%）
  - Active 缩放（95%）
  - 图标平移

### 信息卡片
- **背景**：蓝色到靛蓝色渐变
- **文字**：白色
- **图标**：导航图标（Navigation2）
- **布局**：横向排列，左侧图标，右侧文字

## 代码质量

### 最佳实践
✅ 使用 `useCallback` 优化性能  
✅ 类型安全（TypeScript）  
✅ 无障碍支持（aria-label）  
✅ 响应式设计  
✅ 平滑动画过渡  
✅ 错误处理（步数不足）  
✅ 用户反馈（Toast 提示）  

### 性能优化
- 函数缓存（useCallback）
- 条件渲染
- 最小化重渲染
- 高效的距离计算

## 兼容性
- 不影响探索模式功能
- 向后兼容现有数据
- 支持模式切换
- 保持核心功能稳定

## 未来扩展
- [ ] 自动移动模式（持续移动直到到达）
- [ ] 路径预览（显示移动轨迹）
- [ ] 移动动画（平滑过渡）
- [ ] 自定义移动距离
- [ ] 快速传送（消耗更多步数）
